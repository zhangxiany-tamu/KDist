% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/hypothesis_tests.R
\name{dcov_test}
\alias{dcov_test}
\title{Distance Covariance Test}
\usage{
dcov_test(
  x,
  y,
  a = 1,
  u_center = FALSE,
  n_perm = 1000,
  seed = NULL,
  num_cores = 1,
  is_distance = FALSE
)
}
\arguments{
\item{x}{First dataset (matrix, data frame, or vector) or pre-computed distance matrix}

\item{y}{Second dataset (matrix, data frame, or vector) or pre-computed distance matrix}

\item{a}{Exponent parameter for Euclidean distance (default: 1)}

\item{u_center}{Logical; use U-centering instead of V-centering (default: FALSE).
U-centering provides an unbiased estimate by excluding diagonal terms in the distance matrices.}

\item{n_perm}{Number of permutations to use for the test (default: 1000)}

\item{seed}{Random seed for reproducibility (default: NULL)}

\item{num_cores}{Number of cores for parallel computing (default: 1)}

\item{is_distance}{Logical; whether input matrices x and y are already distance matrices (default: FALSE)}
}
\value{
An object of class "dcov_test" containing:
\item{statistic}{Distance covariance test statistic value}
\item{p.value}{Permutation-based p-value}
\item{permutation_values}{Vector of distance covariance values from permutations}
}
\description{
Performs a permutation test based on the distance covariance to assess independence between
two multivariate random variables. Distance covariance is a powerful nonparametric measure
of dependence that can detect both linear and non-linear associations.
}
\details{
The distance covariance between two random vectors \eqn{X} and \eqn{Y} is a measure of the
dependence between them. It is defined as:

\deqn{dCov^2(X, Y) = E[||X - X'||^a \cdot ||Y - Y'||^a] + E[||X - X'||^a] \cdot E[||Y - Y'||^a] - 2E[||X - X'||^a \cdot ||Y - Y''||^a]}

where \eqn{||.||} denotes Euclidean distance, \eqn{(X', Y')} and \eqn{(X'', Y'')} are
independent copies of \eqn{(X, Y)}, and \eqn{a} is the exponent parameter (usually set to 1).

The distance covariance has the property that \eqn{dCov^2(X, Y) \geq 0}, with equality if and
only if \eqn{X} and \eqn{Y} are independent. This makes it suitable for testing independence
between random variables.

The null hypothesis is that \eqn{X} and \eqn{Y} are independent. The alternative hypothesis
is that they are dependent. The p-value is calculated using a permutation test,
where one sample is randomly permuted while keeping the other fixed to create the null distribution.

U-centering vs. V-centering:

The distance covariance can be estimated using either a V-statistic or a U-statistic:
\enumerate{
\item V-statistic (u_center = FALSE, default):
\deqn{dCov_V^2(X, Y) = \frac{1}{n^2}\sum_{i,j=1}^{n} a_{ij}b_{ij}}
where \eqn{a_{ij}} and \eqn{b_{ij}} are the \eqn{(i,j)}th element of the doubly-centered distance matrices.
\item U-statistic (u_center = TRUE):
\deqn{dCov_U^2(X, Y) = \frac{1}{n(n-3)}\sum_{i \neq j} \tilde{a}_{ij}\tilde{b}_{ij}}
where \eqn{\tilde{a}_{ij}} and \eqn{\tilde{b}_{ij}} are the \eqn{(i,j)}th element of the U-centered distance matrices.
This removes diagonal elements in the distance matrices, providing an unbiased estimator
of distance covariance. U-centering is particularly important for small sample sizes,
as it reduces estimation bias.
}

Note: \code{dcov_test} is implemented as a wrapper around \code{hsic_test} with type="euclidean", as distance
covariance is equivalent to HSIC with a specific kernel.

When is_distance = TRUE, x and y are assumed to be pre-computed distance matrices. In this case,
the parameter a is ignored.
}
\examples{
# Example 1: Independent variables
set.seed(123)
x1 <- matrix(rnorm(100), ncol = 1)
y1 <- matrix(rnorm(100), ncol = 1)
test1 <- dcov_test(x1, y1, n_perm = 200)
print(test1)
plot(test1)

# Example 2: Linear relationship
x2 <- matrix(runif(100), ncol = 1)
y2 <- matrix(2*x2 + 0.1*rnorm(100), ncol = 1)  # Linear relationship with noise
test2 <- dcov_test(x2, y2, n_perm = 200)
print(test2)

# Example 3: Non-linear relationship
x3 <- matrix(runif(100, -3, 3), ncol = 1)
y3 <- matrix(sin(x3) + 0.1*rnorm(100), ncol = 1)  # Sinusoidal relationship
test3 <- dcov_test(x3, y3, n_perm = 200)
print(test3)

# Example 4: Different exponent values
test_a1 <- dcov_test(x3, y3, a = 1, n_perm = 200)  # Standard distance covariance
test_a2 <- dcov_test(x3, y3, a = 2, n_perm = 200)  # Squared distance covariance
print(c(a1 = test_a1$p.value, a2 = test_a2$p.value))

# Example 5: Comparing V-statistic and U-statistic
# For small sample sizes, the difference might be more noticeable
x_small <- matrix(rnorm(30), ncol = 1)
y_small <- matrix(0.5*x_small + rnorm(30, sd = 0.5), ncol = 1)

test_v <- dcov_test(x_small, y_small, u_center = FALSE, n_perm = 200)
test_u <- dcov_test(x_small, y_small, u_center = TRUE, n_perm = 200)

print("V-statistic (biased):")
print(test_v)
print("U-statistic (unbiased):")
print(test_u)

# Example 6: Using multivariate data
x_multi <- matrix(rnorm(200), ncol = 2)
y_multi <- matrix(cbind(x_multi[,1] + rnorm(100, sd = 0.1),
                        x_multi[,2]^2 + rnorm(100, sd = 0.1)), ncol = 2)
test_multi <- dcov_test(x_multi, y_multi, n_perm = 200)
print(test_multi)

# Example 7: Using pre-computed distance matrices
Dx <- as.matrix(dist(x_multi))  # Euclidean distance matrix
Dy <- as.matrix(dist(y_multi))  # Euclidean distance matrix
test_precomp <- dcov_test(Dx, Dy, is_distance = TRUE, n_perm = 200)
print(test_precomp)

# Example 8: Using parallel computing (if multiple cores are available)
\dontrun{
test_parallel <- dcov_test(x_multi, y_multi, n_perm = 1000, num_cores = 4)
print(test_parallel)
}

}
\references{
Székely, G. J., Rizzo, M. L., & Bakirov, N. K. (2007). Measuring and testing dependence by
correlation of distances. The Annals of Statistics, 35(6), 2769-2794.

Székely, G. J., & Rizzo, M. L. (2009). Brownian distance covariance. The Annals of Applied
Statistics, 3(4), 1236-1265.
}
\seealso{
\code{\link{dcov}} for calculating distance covariance without performing a hypothesis test
\code{\link{dcor}} for calculating distance correlation
\code{\link{hsic_test}} for the general HSIC independence test
\code{\link{ed_test}} for the energy distance two-sample test
}
