% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/hypothesis_tests.R
\name{ed_test}
\alias{ed_test}
\title{Energy Distance Test}
\usage{
ed_test(
  x,
  y,
  a = 1,
  u_center = FALSE,
  n_perm = 1000,
  seed = NULL,
  num_cores = 1
)
}
\arguments{
\item{x}{First sample (matrix, data frame, or vector) or full distance matrix if y is NULL}

\item{y}{Second sample (matrix, data frame, or vector)}

\item{a}{Exponent parameter for Euclidean distance (default: 1)}

\item{u_center}{Logical; use U-centering instead of V-centering (default: FALSE).
U-centering provides an unbiased estimate by excluding diagonal terms in the distance matrices.}

\item{n_perm}{Number of permutations to use for the test (default: 1000)}

\item{seed}{Random seed for reproducibility (default: NULL)}

\item{num_cores}{Number of cores for parallel computing (default: 1)}
}
\value{
An object of class "ed_test" containing:
\item{statistic}{Energy distance test statistic value}
\item{p.value}{Permutation-based p-value}
\item{permutation_values}{Vector of energy distance values from permutations}
}
\description{
Performs a permutation test for the equality of distributions based on energy distance.
This is a powerful nonparametric two-sample test that measures the difference between
probability distributions.
}
\details{
The energy distance between two probability distributions F and G is defined as:

\deqn{E(F, G) = 2E||X - Y||^a - E||X - X'||^a - E||Y - Y'||^a}

where \eqn{X, X'} are independent random variables with distribution \eqn{F}, and \eqn{Y, Y'} are
independent random variables with distribution \eqn{G}, \eqn{||\cdot||} denotes Euclidean distance,
and \eqn{a} is the exponent parameter (usually set to 1).

Energy distance has the property that \eqn{E(F, G) ≥ 0}, with equality if and only if \eqn{F = G}.
This makes it suitable for testing whether two samples come from the same distribution.

The null hypothesis is that the two samples come from the same distribution. The alternative
hypothesis is that they come from different distributions. The p-value is calculated
using a permutation test, where the samples are randomly shuffled to create the null
distribution of the test statistic.

U-centering vs. V-centering:

The energy distance can be estimated using either a V-statistic or a U-statistic:
\enumerate{
\item V-statistic (u_center = FALSE, default):
\deqn{E_V(X, Y) = \frac{2}{nm}\sum_{i=1}^{n}\sum_{j=1}^{m}||x_i - y_j||^a - \frac{1}{n^2}\sum_{i=1}^{n}\sum_{j=1}^{n}||x_i - x_j||^a - \frac{1}{m^2}\sum_{i=1}^{m}\sum_{j=1}^{m}||y_i - y_j||^a}
This is a biased estimator but often has better finite-sample properties.
\item U-statistic (u_center = TRUE):
\deqn{E_U(X, Y) = \frac{2}{nm}\sum_{i=1}^{n}\sum_{j=1}^{m}||x_i - y_j||^a - \frac{1}{n(n-1)}\sum_{i \neq j}||x_i - x_j||^a - \frac{1}{m(m-1)}\sum_{i \neq j}||y_i - y_j||^a}
This removes self-distances (i.e., diagonal elements in the distance matrices), providing an
unbiased estimator of energy distance. U-centering is particularly important for small sample sizes,
as it reduces estimation bias.
}

Note: \code{ed_test} is implemented as a wrapper around \code{mmd_test} with type="euclidean", as energy
distance is equivalent to Maximum Mean Discrepancy with a specific kernel.
}
\examples{
# Example 1: Samples from the same distribution
set.seed(123)
x1 <- matrix(rnorm(100 * 3), ncol = 3)  # 100 observations in 3D from N(0,1)
y1 <- matrix(rnorm(80 * 3), ncol = 3)   # 80 observations in 3D from N(0,1)
test1 <- ed_test(x1, y1, n_perm = 200)
print(test1)
plot(test1)

# Example 2: Samples from different distributions
x2 <- matrix(rnorm(100 * 2), ncol = 2)  # From N(0,1)
y2 <- matrix(rnorm(100 * 2, mean = 1), ncol = 2)  # From N(1,1)
test2 <- ed_test(x2, y2, n_perm = 200)
print(test2)

# Example 3: Different exponent values
test_a1 <- ed_test(x2, y2, a = 1, n_perm = 200)  # Standard energy distance
test_a2 <- ed_test(x2, y2, a = 2, n_perm = 200)  # Squared energy distance
print(c(a1 = test_a1$p.value, a2 = test_a2$p.value))

# Example 4: Comparing V-statistic and U-statistic
# For small sample sizes, the difference might be more noticeable
x_small <- matrix(rnorm(30, 0, 1), ncol = 1)
y_small <- matrix(rnorm(30, 0.5, 1), ncol = 1)

test_v <- ed_test(x_small, y_small, u_center = FALSE, n_perm = 200)
test_u <- ed_test(x_small, y_small, u_center = TRUE, n_perm = 200)

print("V-statistic (biased):")
print(test_v)
print("U-statistic (unbiased):")
print(test_u)

# Example 5: Using vector inputs
x5 <- rnorm(50)
y5 <- rnorm(50, mean = 0.5)
test5 <- ed_test(x5, y5, n_perm = 200)
print(test5)

# Example 6: Using parallel computing (if multiple cores are available)
\dontrun{
test_parallel <- ed_test(x2, y2, n_perm = 1000, num_cores = 4)
print(test_parallel)
}

}
\references{
Székely, G. J., & Rizzo, M. L. (2004). Testing for Equal Distributions in High Dimension.
InterStat, Nov. (5).

Székely, G. J., & Rizzo, M. L. (2013). Energy statistics: A class of statistics based on
distances. Journal of Statistical Planning and Inference, 143(8), 1249-1272.

Baringhaus, L., & Franz, C. (2004). On a new multivariate two-sample test.
Journal of Multivariate Analysis, 88(1), 190-206.
}
\seealso{
\code{\link{ed}} for calculating energy distance without performing a hypothesis test
\code{\link{mmd_test}} for the general Maximum Mean Discrepancy test
\code{\link{dcov_test}} for the distance covariance test of independence
}
